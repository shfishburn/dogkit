---
import BaseLayout from "../layouts/BaseLayout.astro";

const breeds = [
  "French Bulldog", "Labrador Retriever", "Golden Retriever", "German Shepherd",
  "Poodle", "Dachshund", "Bulldog", "Beagle", "Rottweiler", "German Shorthaired Pointer",
  "Yorkshire Terrier", "Boxer", "Cavalier King Charles Spaniel", "Doberman Pinscher",
  "Australian Shepherd", "Miniature Schnauzer", "Shih Tzu", "Bernese Mountain Dog",
  "Pembroke Welsh Corgi", "Siberian Husky", "Mixed Breed", "Other",
];
---

<BaseLayout title="Build a plan" description="Calculate your dog's daily energy needs with our MER-based plan builder. Enter weight, age, and activity level to get a personalized feeding guide.">

  <div class="page-header reveal">
    <p class="section-label">MER Calculator</p>
    <h1 class="section-headline" style="font-size:var(--text-3xl);">Build my dog's plan</h1>
    <p class="page-sub">Enter your dog's profile to calculate daily energy needs and a personalized feeding guide. Quick estimate &mdash; not veterinary advice.</p>
  </div>

  <form id="plan-form" class="card plan-form reveal">
    <div class="form-grid">

      <label>
        <span>Breed</span>
        <small class="field-hint">Helps determine life stage thresholds. Giant breeds age faster than small breeds.</small>
        <select name="breed">
          {breeds.map((b) => (
            <option value={b} selected={b === "Mixed Breed"}>{b}</option>
          ))}
        </select>
      </label>

      <label>
        <span>Weight (kg)</span>
        <small class="field-hint">Current weight. We'll adjust for body condition internally.</small>
        <input name="weight_kg" type="number" min="0.5" step="0.1" value="10" required />
      </label>

      <label>
        <span>Age (months)</span>
        <small class="field-hint">Puppies under 12 months have higher energy needs.</small>
        <input name="age_months" type="number" min="1" step="1" value="24" required />
      </label>

      <label>
        <span>Body condition score (1–9)</span>
        <small class="field-hint">BCS 5 is ideal — ribs easily felt, visible waist. Each point above/below ≈ 10% over/under ideal weight.</small>
        <input name="bcs" type="number" min="1" max="9" step="1" value="5" required />
      </label>

      <label>
        <span>Neuter status</span>
        <small class="field-hint">Neutered dogs need ~10% fewer calories due to metabolic changes.</small>
        <select name="neuter_status">
          <option value="neutered" selected>Neutered</option>
          <option value="intact">Intact</option>
        </select>
      </label>

      <label>
        <span>Activity level</span>
        <small class="field-hint">Sedentary: &lt;30 min/day. Moderate: 30–60 min walks. Active: 1–3 hr vigorous. Working: 3+ hr sustained.</small>
        <select name="activity_level">
          <option value="sedentary">Sedentary</option>
          <option value="moderate" selected>Moderate</option>
          <option value="active">Active</option>
          <option value="working">Working</option>
        </select>
      </label>

      <label>
        <span>Goal</span>
        <small class="field-hint">Maintain = baseline calories. Lose = 10–20% deficit. Gain = 10% surplus.</small>
        <select name="weight_goal">
          <option value="maintain" selected>Maintain</option>
          <option value="lose">Lose</option>
          <option value="gain">Gain</option>
        </select>
      </label>

    </div>

    <div class="plan-form__actions">
      <button class="button button--primary" type="submit">Calculate plan</button>
    </div>
  </form>

  <script>
    const form = document.getElementById('plan-form') as HTMLFormElement;

    // Pre-fill from URL params (back-navigation from results page)
    const params = new URLSearchParams(window.location.search);
    for (const [key, val] of params) {
      const el = form.elements.namedItem(key) as HTMLInputElement | HTMLSelectElement | null;
      if (el) el.value = val;
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const qs = new URLSearchParams(fd as any).toString();
      window.location.href = `/plan/results?${qs}`;
    });
  </script>

</BaseLayout>
